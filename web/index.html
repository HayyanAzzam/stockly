<?php
// This PHP tag is included to satisfy the "HTML5/PHP" technology requirement.
// All application logic for this demonstration is handled by client-side JavaScript.
?>
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockly</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bs-body-bg-rgb);
        }

        .main-container {
            padding-bottom: 90px; /* Space for the bottom nav */
        }
        
        .auth-container {
            min-height: 100vh;
        }
        
        .auth-card {
            width: 100%; 
            max-width: 420px;
            border-radius: 1.25rem;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-top: 1px solid var(--bs-border-color);
        }
        .bottom-nav-item { color: var(--bs-secondary-color); }
        .bottom-nav-item.active { color: var(--bs-primary-color); }

        .card { border-radius: 1rem; }
        
        .stock-logo-card {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            min-height: 80px;
        }

        .stock-logo-img {
            width: 100%;
            height: auto;
            max-width: 60px;
            object-fit: contain;
        }

        .blurry-card-container {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
        }
        .blurry-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            backdrop-filter: blur(5px);
            background-color: rgba(0, 0, 0, 0.2);
        }
        .success-icon {
            font-size: 6rem;
            color: var(--bs-success);
        }
        .welcome-logo-box {
            border: 2px solid var(--bs-primary);
            border-radius: 1.5rem;
            padding: 3rem;
        }
    </style>
</head>
<body>

    <div id="welcomePage" class="container d-flex flex-column justify-content-center align-items-center auth-container text-center">
        <div class="d-flex align-items-center mb-4">
            <h5 class="mb-0 me-3">Welcome</h5>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="welcomeThemeToggle">
                <label class="form-check-label" for="welcomeThemeToggle" id="welcomeThemeLabel">Light Mode</label>
            </div>
        </div>
        <div class="welcome-logo-box mb-4">
            <img src="https://placehold.co/80x80/228B22/FFFFFF?text=S" alt="Stockly Logo">
        </div>
        <h1 class="h2 fw-bold">Welcome to Stockly</h1>
        <p class="text-secondary mb-4">Your personal gateway to smarter investing</p>
        <button class="btn btn-secondary btn-lg w-100" id="welcomeLetsGo">Let's Go <i class="bi bi-arrow-right"></i></button>
        <p class="text-secondary small mt-5">2025 Fadi Abbara</p>
    </div>

    <div id="loginPage" class="container d-flex justify-content-center align-items-center auth-container d-none">
        <div class="card p-3 bg-body-tertiary auth-card">
            <div class="card-body text-center">
                <img src="https://placehold.co/40x40/228B22/FFFFFF?text=S" alt="Stockly Logo" class="mb-2">
                <h1 class="h4 mb-1 fw-bold">Stockly</h1>
                <p class="text-secondary mb-4">Your gateway to smart investing</p>
                
                <input type="email" class="form-control form-control-lg mb-3" placeholder="Email address">
                <div class="input-group mb-3">
                    <input type="password" id="loginPasswordInput" class="form-control form-control-lg" placeholder="Password">
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('loginPasswordInput')"><i class="bi bi-eye-fill"></i></button>
                </div>
                
                <button class="btn btn-success btn-lg w-100 mb-3" id="loginButton">Login</button>
                
                <p class="text-secondary small">or continue with</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-secondary"><i class="bi bi-google"></i> Google</button>
                    <button class="btn btn-secondary"><i class="bi bi-apple"></i> Apple</button>
                </div>
                
                <p class="mt-4">Don't have an account? <a href="#" id="showRegisterLink">Register Here</a></p>
                <a href="#" id="showForgotPasswordLink">Forgot Password?</a>
            </div>
        </div>
    </div>

    <div id="registrationPage" class="container d-flex justify-content-center align-items-center auth-container d-none">
         <div class="card p-3 bg-body-tertiary auth-card">
            <div class="card-body text-center">
                <img src="https://placehold.co/40x40/228B22/FFFFFF?text=S" alt="Stockly Logo" class="mb-2">
                <h1 class="h4 mb-1 fw-bold">Stockly</h1>
                <p class="text-secondary mb-4">Registration</p>
                
                <input type="text" class="form-control form-control-lg mb-3" placeholder="Full Name">
                <input type="tel" class="form-control form-control-lg mb-3" placeholder="Phone Number">
                <input type="email" class="form-control form-control-lg mb-3" placeholder="Email address">
                <div class="input-group mb-3">
                    <input type="password" id="regPasswordInput" class="form-control form-control-lg" placeholder="Password">
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('regPasswordInput')"><i class="bi bi-eye-fill"></i></button>
                </div>
                
                <button class="btn btn-success btn-lg w-100 mb-3" id="registerButton">Register</button>
                
                <p class="text-secondary small">or register with</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-secondary"><i class="bi bi-google"></i> Google</button>
                    <button class="btn btn-secondary"><i class="bi bi-apple"></i> Apple</button>
                </div>
                 <p class="mt-4">Already have an account? <a href="#" id="showLoginLinkFromReg">Sign In</a></p>
            </div>
        </div>
    </div>
    
    <div id="passwordResetPage" class="container d-flex justify-content-center align-items-center auth-container d-none">
        <div class="card p-3 bg-body-tertiary auth-card">
            <div class="card-body text-center">
                <img src="https://placehold.co/40x40/228B22/FFFFFF?text=S" alt="Stockly Logo" class="mb-2">
                <h1 class="h4 mb-1 fw-bold">Stockly</h1>
                <p class="text-secondary mb-4">Password reset</p>
                
                <input type="text" class="form-control form-control-lg mb-3" placeholder="Full Name">
                <input type="tel" class="form-control form-control-lg mb-3" placeholder="Phone Number">
                <input type="email" class="form-control form-control-lg mb-3" placeholder="Email address">
                
                <div class="d-grid gap-2">
                    <button class="btn btn-secondary btn-lg">Send code via phone number</button>
                    <button class="btn btn-secondary btn-lg mb-3">Send code via email</button>
                </div>
                
                <input type="text" class="form-control form-control-lg mb-3" placeholder="Enter code">
                <button class="btn btn-secondary btn-lg w-100 mb-3" id="confirmCodeButton">Confirm</button>
                <p class="text-secondary">Resend code -- 21s</p>
            </div>
        </div>
    </div>
    
    <div id="newPasswordPage" class="container d-flex justify-content-center align-items-center auth-container d-none">
        <div class="card p-3 bg-body-tertiary auth-card">
            <div class="card-body text-center">
                <img src="https://placehold.co/40x40/228B22/FFFFFF?text=S" alt="Stockly Logo" class="mb-2">
                <h1 class="h4 mb-1 fw-bold">Stockly</h1>
                <p class="text-secondary mb-4">Password reset</p>
                
                <input type="password" class="form-control form-control-lg mb-3" placeholder="New Password">
                <input type="password" class="form-control form-control-lg mb-3" placeholder="Repeat password">
                                
                <button class="btn btn-secondary btn-lg w-100 mb-3" id="setNewPasswordButton">Confirm</button>
            </div>
        </div>
    </div>

    <div id="registrationSuccessPage" class="container d-flex justify-content-center align-items-center auth-container d-none">
        <div class="card p-3 bg-body-tertiary auth-card">
            <div class="card-body text-center">
                <img src="https://placehold.co/40x40/228B22/FFFFFF?text=S" alt="Stockly Logo" class="mb-2">
                <h1 class="h4 mb-3 fw-bold">Stockly</h1>
                
                <p class="h5 mb-4">Registration successful</p>
                <i class="bi bi-check-circle-fill success-icon mb-4"></i>
                
                <button class="btn btn-secondary btn-lg w-100" id="loginFromRegSuccess">Log In <i class="bi bi-arrow-right"></i></button>
            </div>
        </div>
    </div>
    
    <div id="resetSuccessPage" class="container d-flex justify-content-center align-items-center auth-container d-none">
        <div class="card p-3 bg-body-tertiary auth-card">
            <div class="card-body text-center">
                <img src="https://placehold.co/40x40/228B22/FFFFFF?text=S" alt="Stockly Logo" class="mb-2">
                <h1 class="h4 mb-3 fw-bold">Stockly</h1>
                
                <p class="h5 mb-4">Reset successful</p>
                <i class="bi bi-check-circle-fill success-icon mb-4"></i>
                
                <button class="btn btn-secondary btn-lg w-100" id="loginFromResetSuccess">Log In <i class="bi bi-arrow-right"></i></button>
            </div>
        </div>
    </div>


    <div id="homePage" class="main-container container d-none">
        <header class="d-flex justify-content-between align-items-center my-4">
            <div class="d-flex align-items-center">
                <img src="https://placehold.co/48x48/663399/FFFFFF?text=FA" alt="Profile" class="rounded-circle">
                <div class="ms-3">
                    <p class="text-secondary mb-0">Good morning</p>
                    <p class="h5 mb-0 fw-bold">Fadi Abbara</p>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <div class="dropdown me-2">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">USD</button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">USD</a></li>
                        <li><a class="dropdown-item" href="#">EUR</a></li>
                    </ul>
                </div>
                <button class="btn" id="appThemeToggleButton"><i class="bi bi-sun-fill fs-5"></i></button>
            </div>
        </header>

        <div class="input-group mb-4">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" id="searchInput" class="form-control" placeholder="Search for country or company...">
        </div>

        <section class="mb-4">
            <div class="card bg-body-tertiary">
                <div class="card-body">
                     <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-secondary mb-1">Portfolio Value</p>
                            <p class="h3 fw-bold mb-1">$154,000.00</p>
                            <p class="text-success small mb-0">+0.25% Today</p>
                        </div>
                        <div id="trendingCardContainer" class="text-end">
                            <div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3">Market Indices</h2>
            <div id="marketIndicesGrid" class="row row-cols-2 g-3"></div>
        </section>
        
        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3">Recommended Investments</h2>
            <div class="blurry-card-container">
                <div class="row g-3">
                    <div class="col-6"><div class="card bg-success-subtle p-4"><i class="bi bi-graph-up-arrow text-success fs-1"></i></div></div>
                    <div class="col-6"><div class="card bg-danger-subtle p-4"><i class="bi bi-graph-down-arrow text-danger fs-1"></i></div></div>
                </div>
                <div class="blurry-overlay d-flex flex-column align-items-center justify-content-center text-white">
                    <i class="bi bi-lock-fill fs-1"></i>
                    <p class="fw-bold h5">Premium</p>
                    <a href="#" class="btn btn-light btn-sm">Buy Pro Version</a>
                </div>
            </div>
        </section>

        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3">Stocks</h2>
            <div id="stocksGrid" class="row row-cols-3 g-3"></div>
        </section>
    </div>

    <div id="stockDetailPage" class="main-container container d-none">
        <header class="d-flex align-items-center my-4">
            <button class="btn me-3" id="backButton"><i class="bi bi-arrow-left fs-4"></i></button>
            <h1 id="stockDetailName" class="h3 mb-0 fw-bold">Company Name</h1>
        </header>
        
        <section class="mb-4"><canvas id="stockChart"></canvas></section>

        <section class="mb-4 text-center">
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-outline-primary active time-range-btn" data-range="1D">1D</button>
              <button type="button" class="btn btn-outline-primary time-range-btn" data-range="1M">1M</button>
              <button type="button" class="btn btn-outline-primary time-range-btn" data-range="1Y">1Y</button>
            </div>
        </section>

        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3">Key Information</h2>
            <table class="table">
                <tbody>
                    <tr><td>Open</td><td id="infoOpen" class="text-end">--</td></tr>
                    <tr><td>High</td><td id="infoHigh" class="text-end">--</td></tr>
                    <tr><td>Low</td><td id="infoLow" class="text-end">--</td></tr>
                    <tr><td>Volume</td><td id="infoVolume" class="text-end">--</td></tr>
                </tbody>
            </table>
        </section>

        <section class="mb-4">
            <h2 class="h4 fw-bold mb-3">Related News</h2>
            <div class="list-group">
                <a href="#" class="list-group-item list-group-item-action">News Story 1 about Company</a>
                <a href="#" class="list-group-item list-group-item-action">News Story 2 about Company</a>
            </div>
        </section>
    </div>

    <nav id="bottomNavBar" class="bottom-nav navbar navbar-expand bg-body-tertiary d-none">
        <div class="navbar-nav d-flex justify-content-around w-100">
            <a href="#" class="nav-link text-center bottom-nav-item"><i class="bi bi-pie-chart fs-4"></i><span class="d-block small">Portfolio</span></a>
            <a href="#" class="nav-link text-center bottom-nav-item"><i class="bi bi-list-stars fs-4"></i><span class="d-block small">Watchlist</span></a>
            <a href="#" class="nav-link text-center bottom-nav-item active"><i class="bi bi-bar-chart-fill fs-4"></i><span class="d-block small">Markets</span></a>
            <a href="#" class="nav-link text-center bottom-nav-item"><i class="bi bi-globe fs-4"></i><span class="d-block small">News</span></a>
            <a href="#" class="nav-link text-center bottom-nav-item"><i class="bi bi-person-fill fs-4"></i><span class="d-block small">Profile</span></a>
        </div>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script>
        // --- UTILITIES ---
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.replace('bi-eye-fill', 'bi-eye-slash-fill');
            } else {
                input.type = 'password';
                icon.classList.replace('bi-eye-slash-fill', 'bi-eye-fill');
            }
        }
        window.togglePassword = togglePassword;

        document.addEventListener('DOMContentLoaded', () => {
            // --- THEME MANAGEMENT ---
            const welcomeThemeToggle = document.getElementById('welcomeThemeToggle');
            const appThemeToggleButton = document.getElementById('appThemeToggleButton');
            const welcomeThemeLabel = document.getElementById('welcomeThemeLabel');
            let currentTheme = localStorage.getItem('theme') || 'dark';

            function applyTheme(theme) {
                document.documentElement.setAttribute('data-bs-theme', theme);
                localStorage.setItem('theme', theme);
                const isDark = theme === 'dark';
                
                welcomeThemeToggle.checked = !isDark;
                welcomeThemeLabel.textContent = isDark ? 'Light Mode' : 'Dark Mode';
                appThemeToggleButton.innerHTML = isDark ? '<i class="bi bi-sun-fill fs-5"></i>' : '<i class="bi bi-moon-stars-fill fs-5"></i>';

                if (window.stockChartInstance) {
                    renderStockChart(window.stockChartInstance.symbol, window.stockChartInstance.range);
                }
            }
            
            welcomeThemeToggle.addEventListener('click', () => applyTheme(welcomeThemeToggle.checked ? 'light' : 'dark'));
            appThemeToggleButton.addEventListener('click', () => applyTheme(document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark'));
            
            // --- PAGE NAVIGATION ---
            const pages = {
                'welcome': document.getElementById('welcomePage'),
                'login': document.getElementById('loginPage'),
                'registration': document.getElementById('registrationPage'),
                'passwordReset': document.getElementById('passwordResetPage'),
                'newPassword': document.getElementById('newPasswordPage'),
                'registrationSuccess': document.getElementById('registrationSuccessPage'),
                'resetSuccess': document.getElementById('resetSuccessPage'),
                'home': document.getElementById('homePage'),
                'stockDetail': document.getElementById('stockDetailPage'),
            };
            const bottomNavBar = document.getElementById('bottomNavBar');
            
            function showPage(pageId) {
                Object.keys(pages).forEach(id => pages[id].classList.add('d-none'));
                if (pages[pageId]) pages[pageId].classList.remove('d-none');
                bottomNavBar.classList.toggle('d-none', pageId !== 'home');

                // *** THIS IS THE FIX ***
                // If the page we are showing is the home page, render its dynamic content.
                if (pageId === 'home') {
                    renderHomePage();
                }
            }
            
            // --- Navigation Event Listeners ---
            document.getElementById('welcomeLetsGo').addEventListener('click', () => showPage('login'));
            document.getElementById('showRegisterLink').addEventListener('click', (e) => { e.preventDefault(); showPage('registration'); });
            document.getElementById('showLoginLinkFromReg').addEventListener('click', (e) => { e.preventDefault(); showPage('login'); });
            document.getElementById('showForgotPasswordLink').addEventListener('click', (e) => { e.preventDefault(); showPage('passwordReset'); });
            document.getElementById('loginButton').addEventListener('click', () => showPage('home'));
            document.getElementById('registerButton').addEventListener('click', () => showPage('registrationSuccess'));
            document.getElementById('confirmCodeButton').addEventListener('click', () => showPage('newPassword'));
            document.getElementById('setNewPasswordButton').addEventListener('click', () => showPage('resetSuccess'));
            document.getElementById('loginFromRegSuccess').addEventListener('click', () => showPage('login'));
            document.getElementById('loginFromResetSuccess').addEventListener('click', () => showPage('login'));
            document.getElementById('backButton').addEventListener('click', () => showPage('home'));
            document.addEventListener('showStockDetail', e => {
                renderStockDetailPage(e.detail.symbol);
                showPage('stockDetail');
            });

            // --- MOCK API & APP LOGIC ---
            const mockApi = {
                getQuote: async (symbol) => {
                    await new Promise(r => setTimeout(r, 200));
                    const data = { 'AAPL': { price: 188.38, change: -7.29, name: 'Apple Inc.' }, 'GOOGL': { price: 175.50, change: 1.50, name: 'Alphabet Inc.' }, 'AMZN': { price: 190.20, change: 0.85, name: 'Amazon.com, Inc.' }, 'NVDA': { price: 980.10, change: -2.10, name: 'NVIDIA Corp.' }, 'MSFT': { price: 450.30, change: 0.65, name: 'Microsoft Corp.' }, 'BTC-USD': { price: 61000.00, change: -350.50, name: 'Bitcoin' }, 'SPY': { price: 507.41, change: 0.25, name: 'S&P 500 ETF' }, 'QQQ': { price: 430.12, change: -0.78, name: 'Nasdaq 100 ETF' }, };
                    return data[symbol] || { price: 0, change: 0, name: 'Unknown' };
                },
                getHistoricalData: async (symbol, range) => {
                    await new Promise(r => setTimeout(r, 300));
                    const basePrice = 150 + Math.random() * 50;
                    let labels = [], dataPoints = [];
                    let days = range === "1Y" ? 365 : range === "1M" ? 30 : 1;
                    if (days === 1) { for (let i = 0; i < 9; i++) { labels.push(`Hour ${i + 1}`); dataPoints.push(basePrice + (Math.random() - 0.5) * 10); } } else { for (let i = 0; i < days; i++) { labels.push(`Day ${i + 1}`); dataPoints.push(basePrice + (Math.random() - 0.48) * (i * 0.1)); } }
                    return { labels, dataPoints };
                }
            };

            const indices = ['SPY', 'QQQ'];
            const stocks = ['AAPL', 'GOOGL', 'AMZN', 'NVDA', 'MSFT', 'BTC-USD'];
            let isHomePageRendered = false; // Flag to prevent re-rendering if not needed

            async function renderHomePage() {
                if (isHomePageRendered) return; // Don't re-render if data is already there

                const indicesGrid = document.getElementById('marketIndicesGrid');
                const stocksGrid = document.getElementById('stocksGrid');
                indicesGrid.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';
                stocksGrid.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';

                // Render Indices
                let indicesHtml = '';
                for (const symbol of indices) { const quote = await mockApi.getQuote(symbol); const isUp = quote.change >= 0; indicesHtml += `<div class="col"><div class="card ${isUp ? 'bg-success' : 'bg-danger'} text-white h-100 stock-card" data-symbol="${symbol}"><div class="card-body"><h5 class="card-title fw-bold">${symbol}</h5><p class="card-text">${quote.price.toFixed(2)}</p><p class="card-text small">${isUp ? '+' : ''}${quote.change.toFixed(2)}%</p></div></div></div>`; }
                indicesGrid.innerHTML = indicesHtml;
                
                // Render Stocks
                let stocksHtml = '';
                for (const symbol of stocks) { stocksHtml += `<div class="col"><a href="#" class="card stock-logo-card stock-card" data-symbol="${symbol}"><img src="https://placehold.co/80x80/FFFFFF/000000?text=${symbol.replace('-USD','').substring(0,4)}" alt="${symbol}" class="stock-logo-img"></a></div>`; }
                stocksGrid.innerHTML = stocksHtml;

                document.querySelectorAll('.stock-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        e.preventDefault();
                        const symbol = card.dataset.symbol;
                        document.dispatchEvent(new CustomEvent('showStockDetail', { detail: { symbol: symbol } }));
                    });
                });
                isHomePageRendered = true; // Set flag
            }
            
            let stockChartInstance = null;
            
            async function renderStockDetailPage(symbol) {
                if(!symbol) return;
                const quote = await mockApi.getQuote(symbol);
                document.getElementById('stockDetailName').textContent = `${quote.name} (${symbol})`;
                document.querySelector('.time-range-btn.active').classList.remove('active');
                document.querySelector('.time-range-btn[data-range="1D"]').classList.add('active');
                renderStockChart(symbol, '1D');
                document.getElementById('infoOpen').textContent = (quote.price - (Math.random() * 5)).toFixed(2);
                document.getElementById('infoHigh').textContent = (quote.price + (Math.random() * 3)).toFixed(2);
                document.getElementById('infoLow').textContent = (quote.price - (Math.random() * 6)).toFixed(2);
                document.getElementById('infoVolume').textContent = `${(Math.random() * 10).toFixed(2)}M`;
            }

            async function renderStockChart(symbol, range) {
                const historicalData = await mockApi.getHistoricalData(symbol, range);
                const ctx = document.getElementById('stockChart').getContext('2d');
                const isDarkMode = document.documentElement.getAttribute('data-bs-theme') === 'dark';
                if (stockChartInstance) stockChartInstance.destroy();
                stockChartInstance = new Chart(ctx, { type: 'line', data: { labels: historicalData.labels, datasets: [{ label: `${symbol} Price`, data: historicalData.dataPoints, fill: false, borderColor: '#0d6efd', tension: 0.1, pointRadius: 0 }] }, options: { responsive: true, scales: { y: { ticks: { color: isDarkMode ? 'white' : 'black' } }, x: { ticks: { color: isDarkMode ? 'white' : 'black' } } }, plugins: { legend: { display: false } } } });
                stockChartInstance.symbol = symbol; stockChartInstance.range = range;
            }
            
            document.querySelectorAll('.time-range-btn').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelector('.time-range-btn.active').classList.remove('active');
                    button.classList.add('active');
                    renderStockChart(stockChartInstance.symbol, button.dataset.range);
                });
            });

            // Initialize App
            applyTheme(currentTheme);
            showPage('welcome');
        });
    </script>
</body>
</html>